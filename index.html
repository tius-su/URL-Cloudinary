<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload & Galeri Media</title>
  <style>
    body { font-family: sans-serif; background: #f0f4f8; margin: 0; padding: 20px; }
    h1 { color: #2c3e50; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .tab-button {
      background: #ccc; border: none; padding: 10px 15px; border-radius: 8px;
      cursor: pointer; font-weight: bold;
    }
    .tab-button.active { background: #2ecc71; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .file-card {
      background: #fff; border-radius: 10px; padding: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    video, img {
      max-width: 100%; border-radius: 10px; margin-top: 10px;
    }
    .info { font-size: 14px; margin-top: 10px; }
    .progress-bar { height: 10px; background: #eee; border-radius: 6px; overflow: hidden; margin-top: 10px; }
    .progress-fill { height: 100%; background: #3498db; width: 0%; transition: width 0.4s ease; }
    .btn { padding: 6px 12px; border: none; border-radius: 5px; margin-top: 8px; margin-right: 5px; cursor: pointer; font-size: 13px; }
    .copy-btn { background: #3498db; color: white; }
    .download-btn { background: #2ecc71; color: white; }
    .share-btn { background: #f39c12; color: white; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>Upload Media ke Cloudinary</h1>
<input type="file" id="fileInput" multiple accept="image/*,video/*">
<button onclick="uploadFiles()">Upload</button><div class="tabs">
  <button class="tab-button active" onclick="switchTab('upload')">Upload</button>
  <button class="tab-button" onclick="switchTab('gallery-photo')">Galeri Foto</button>
  <button class="tab-button" onclick="switchTab('gallery-video')">Galeri Video</button>
</div><div id="upload" class="tab-content active"></div>
<div id="gallery-photo" class="tab-content"></div>
<div id="gallery-video" class="tab-content"></div><script>
  const firebaseConfig = {
    apiKey: "AIzaSyAnnfK9njvEp2jPFxc-wnPldwxaNqp2GgE",
    authDomain: "homepage-71aa8.firebaseapp.com",
    projectId: "homepage-71aa8",
    storageBucket: "homepage-71aa8.appspot.com",
    messagingSenderId: "238347756112",
    appId: "1:238347756112:web:6b33d6772f3568385f2755"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const cloudName = 'dyvoydnx8';
  const uploadPreset = 'home-pages';

  function switchTab(id) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelector(`.tab-button[onclick*="${id}"]`).classList.add('active');
    document.getElementById(id).classList.add('active');
  }

  async function uploadFiles() {
    const files = document.getElementById('fileInput').files;
    if (!files.length) return alert('Pilih file terlebih dahulu.');

    for (const file of files) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', uploadPreset);

      const container = document.createElement('div');
      container.className = 'file-card';
      container.innerHTML = `<p><strong>${file.name}</strong></p>
        <div class="progress-bar"><div class="progress-fill"></div></div>
        <p class="info">Mengupload...</p>`;
      document.getElementById('upload').appendChild(container);
      const progressFill = container.querySelector('.progress-fill');
      const infoBox = container.querySelector('.info');

      const xhr = new XMLHttpRequest();
      xhr.open('POST', `https://api.cloudinary.com/v1_1/${cloudName}/auto/upload`, true);

      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) progressFill.style.width = `${(e.loaded / e.total * 100).toFixed(0)}%`;
      };

      xhr.onload = async () => {
        const res = JSON.parse(xhr.responseText);
        const url = res.secure_url;
        const resource = res.resource_type;

        infoBox.innerHTML = `
          <strong>URL:</strong> <a href="${url}" target="_blank">${url}</a><br>
          <button class="btn copy-btn" onclick="navigator.clipboard.writeText('${url}')">Salin</button>
          <a href="${url}" download class="btn download-btn">Download</a>
          <a href="https://wa.me/?text=${encodeURIComponent(url)}" target="_blank" class="btn share-btn">WhatsApp</a>
        `;

        const preview = resource === 'image' ? `<img src="${url}">` : `<video src="${url}" controls></video>`;
        container.insertAdjacentHTML('beforeend', preview);

        // Simpan ke Firebase
        await db.collection(resource === 'image' ? 'fotos' : 'videos').add({ url, date: new Date() });
        loadGallery();
      };

      xhr.onerror = () => {
        infoBox.innerHTML = '<span style="color:red;">Gagal upload.</span>';
      };

      xhr.send(formData);
    }
  }

  async function loadGallery() {
    ['fotos', 'videos'].forEach(async type => {
      const snap = await db.collection(type).orderBy('date', 'desc').limit(10).get();
      const wrapper = document.getElementById(`gallery-${type === 'fotos' ? 'photo' : 'video'}`);
      wrapper.innerHTML = '';
      snap.forEach(doc => {
        const data = doc.data();
        const el = document.createElement('div');
        el.className = 'file-card';
        const preview = type === 'fotos' ? `<img src="${data.url}">` : `<video src="${data.url}" controls></video>`;
        el.innerHTML = `
          ${preview}
          <div class="info">
            <strong>URL:</strong> <a href="${data.url}" target="_blank">${data.url}</a><br>
            <button class="btn copy-btn" onclick="navigator.clipboard.writeText('${data.url}')">Salin</button>
            <a href="${data.url}" download class="btn download-btn">Download</a>
            <a href="https://wa.me/?text=${encodeURIComponent(data.url)}" target="_blank" class="btn share-btn">WhatsApp</a>
          </div>
        `;
        wrapper.appendChild(el);
      });
    });
  }

  window.onload = loadGallery;
</script></body>
</html>
